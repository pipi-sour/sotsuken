# 卒業研究 定例会資料(2018/12/12)

<div style="text-align:right">5D No.9 大澤武流</div>

## 1. 卒業研究題目

12/4に発表した仮称から変更なし。

* 題目: MPIを用いた日本語OCRの高速化に関する研究
* Theme: A Studying of faster OCR for Japanese language using MPI

## 2. 研究内容

* オープンソースのOCRライブラリであるTesseract OCRを、MPIを用いて複数のマシンで並列処理することにより高速化を試みる。
* 想定しているのは数十〜数百枚の画像が綴じ込まれたPDF文書。
* 余裕があれば、OpenCVを用いた画像解析を行い、高速化と高精度化を行う。

## 3. 進捗状況

* 1台のマスターノードに複数のプロセスを起動し、同一の2つの画像を用いてTesseract OCRの並列化を行ったところ、速度の大幅な遅延が発生した。

```
Will use tool 'Tesseract (sh)'
Available languages: eng, jpn, jpn_vert, osd
Will use lang 'jpn'
--- 結果 ---
課題:使用書 (岡本和夫ほか 『新版確率統計 』[教出版 )から、授業された問題を解き、答え合わせをする。に指示
課題:使用書 (岡本和夫ほか 『新版確率統計 』[教出版 )から、授業された問題を解き、答え合わせをする。に指示
全実行時間: 3.8575s.
```

__<div style="text-align:center">図1 逐次版の実行結果</div>__

```
osawa@takeru-ml:/home/mpiuser/shared$ mpiexec -np 4 python3 image2text_a.py ouyou
Running from processor takeru-ml, rank 0 out of 4 processors.
Running from processor takeru-ml, rank 1 out of 4 processors.
Running from processor takeru-ml, rank 3 out of 4 processors.
Now sending ouyou1.png to 1
Now sending ouyou2.png to 2
Now sending empty message to 3
Running from processor takeru-ml, rank 2 out of 4 processors.
Now sending 0 to master from 3
Now Received from 1
Now Analyzing pdf2img/ouyou1.png from 1
Now Analyzing pdf2img/ouyou2.png from 2
Sending Complete from 3
プロセス3実行時間: 0.0003s
Will use tool 'Tesseract (sh)'
Will use tool 'Tesseract (sh)'
Available languages: eng, jpn, jpn_vert, osd
Will use lang 'jpn'
Available languages: eng, jpn, jpn_vert, osd
Will use lang 'jpn'
Now sending to master from 2
Sending Complete from 2
プロセス2実行時間: 25.7922s
Now sending to master from 1
Sending Complete from 1
プロセス1実行時間: 26.7221s
課題:使用書 (岡本和夫ほか 『新版確率統計 』[教出版 )から、授業された問題を解き、答え合わせをする。に指示 is appended.
Now Received from 2
課題:使用書 (岡本和夫ほか 『新版確率統計 』[教出版 )から、授業された問題を解き、答え合わせをする。に指示
課題:使用書 (岡本和夫ほか 『新版確率統計 』[教出版 )から、授業された問題を解き、答え合わせをする。に指示 is appended.
Now Received from 3
--- 結果 ---
課題:使用書 (岡本和夫ほか 『新版確率統計 』[教出版 )から、授業された問題を解き、答え合わせをする。に指示
課題:使用書 (岡本和夫ほか 『新版確率統計 』[教出版 )から、授業された問題を解き、答え合わせをする。に指示
全実行時間: 26.7237s.
```

__<div style="text-align:center">図2 逐次版の実行結果</div>__

* 逐次版で3秒程度で終了する処理に、並列化で25秒近くかかってしまった。全体の実行時間とプロセス1のそれを比較するとほとんど変わらないことから、メッセージパッシングではなくOCRの処理に大きな時間がかかっていることがわかる。
* 掲載した並列版より前の版では、UbuntuのシステムモニタからCPUやメモリの使用状況を監視したところ処理が終了したプロセスの処理待ちのためリソースを消費していたことから、現在の版ではマスターがワーカーに対し終了命令を送信し、ワーカーがそれを受信したら終了する処理にした。その結果いくばくか高速化されたが、逐次版にはまったく及ばなかった。
* マスターノードが画像の分担後アイドル状態になっているため、それにも無駄なリソースが費やされているが、これは分散処理により解決できると考えられる。
* 現在、ワーカーノードへの画像動的分担機能を開発中である。

## 4. 今後の予定

* 動的分担機能を開発できたら、複数のマシンでプログラムを稼働させ、今回の結果からどう変わるかを計測する。